function inArray(a,b){var c;for(c=0;c<a.length;c++){if(a[c]===b)return true}return false}function formatCurrency(a,b,c,d,e){a=a.toString().replace(/\$|\,/g,"");if(isNaN(a))a="0";var f=a==(a=Math.abs(a));a=Math.floor(a*100+.50000000001);var g=a%100;a=Math.floor(a/100).toString();if(g<10)g="0"+g;for(var h=0;h<Math.floor((a.length-(1+h))/3);h++)a=a.substring(0,a.length-(4*h+3))+c+a.substring(a.length-(4*h+3));var i=(f?"":"-")+b+a;if(g!="00"||e)i+=d+g;return i}function Popup(){this.background_color;this.background_opacity}function AnimationAbstraction(a){this.has_animation=a.has_animation;this.event_duration=a.event_duration;this.delay=a.delay;this.easing=a.easing;this.timeline_delay=this.delay;this.total_duration=0;this.total_delay=0;this.current_event_duration=this.event_duration;this.current_delay=this.delay;this.current_easing=this.easing;this.elements_queue=new Array;this.attributes_queue=new Array;this._animation;this.handle=function(a,b,c){this._animation=null;if(this.has_animation){this._animation=Raphael.animation(b,this.current_event_duration,this.current_easing,c);a.animate(this._animation.delay(this.current_delay));this.total_duration+=this.current_event_duration+this.current_delay;this.resetCurrent()}else{a.attr(b)}return this._animation};this.handleCustom=function(a,b,c,d){if(b.delay!=null)this.nextDelay(b.delay);if(b.event_duration!=null)this.nextEventDuration(b.event_duration);if(b.easing!=null)this.nextEasing(b.easing);return this.handle(a,c,d)};this.pushToTimelineDelayed=function(a,b,c){this.nextDelay(this.total_delay+this.current_delay);this.total_delay+=this.current_delay-this.total_delay;return this.handle(a,b,c)};this.pushToTimelineUndelayed=function(a,b,c){this.nextDelay(this.total_delay);return this.handle(a,b,c)};this.pushToTimelineCustom=function(a,b,c,d){var e=this.total_delay;if(b.delay!=null)e+=b.delay;this.nextDelay(e);if(b.event_duration!=null)this.nextEventDuration(b.event_duration);if(b.easing!=null)this.nextEasing(b.easing);this.total_delay+=this.current_delay-this.total_delay;return this.handle(a,c,d)};this.syncAnimation=function(a,b,c,d){};this.queueAnimation=function(a,b){var c=null;if(this.has_animation){if(a!==null&&b!==null){this.elements_queue.push(a);this.attributes_queue.push(b);console.log(a);console.log(b);console.log(this.elements_queue);console.log(this.attributes_queue);function d(){c=Raphael.animation(this.attributes_queue.shift(),this.current_event_duration,this.current_easing,function(){this.queueAnimation(this.elements_queue.shift(),this.attributes_queue.shift())});this.elements_queue.shift().animate(c.delay(this.current_delay))}d()}}else{a.attr(b)}return c};this.nextDelay=function(a){if(a<0)a=0;this.current_delay=a};this.nextEventDuration=function(a){if(a<0)a=0;this.current_event_duration=a};this.nextEasing=function(a){if(a<0)a=0;this.current_easing=a};this.resetCurrent=function(){this.current_event_duration=this.event_duration;this.current_delay=this.delay;this.current_easing=this.easing};this.pause=function(){}}function Options(a){this.type;this.id_holder;this.value;this.width;this.height;this.color;this.color_alt;this.easing;this.delay;this.event_duration;this.popup_background_color;this.popup_background_opacity;this.has_popup;this.has_animation;this.toString=function(){var a="Options\n";for(var b=0;b<this.length;b++){a+=this[b]}return"Common Options\n"+" type: "+this.type+"\n"+" id_holder: "+this.id_holder+"\n"+" value: "+this.value+"\n"+" width: "+this.width+"\n"+" height: "+this.height+"\n"+" color: "+this.color+"\n"+" color_alt: "+this.color_alt+"\n"+" easing: "+this.easing+"\n"+" delay: "+this.delay+"\n"+" event_duration: "+this.event_duration+"\n"+" popup_background_color: "+this.popup_background_color+"\n"+" popup_background_opacity: "+this.popup_background_opacity+"\n"+" has_popup: "+this.has_popup+"\n"+" has_animation: "+this.has_animation+"\n"};this.constructor=function(){if(a==null)throw"RaphaelAquarious: missing arguments";if(a.type!=null&&a.id_holder!=null){this.type=a.type;this.id_holder=a.id_holder}else throw"RaphaelAquarious: missing options";this.value=a.value!=null?a.value:0;this.width=a.width!=null?a.width:400;this.height=a.height!=null?a.height:400;this.color=a.color!=null?a.color:null;this.color_alt=a.color_alt!=null?a.color_alt:null;this.easing=a.easing!=null?a.easing:"<>";this.delay=a.delay!=null?a.delay:0;this.event_duration=a.event_duration!=null?a.event_duration:0;this.popup_background_color=a.popup_background_color!=null?a.popup_background_color:"#000";this.popup_background_opacity=a.popup_background_opacity!=null?a.popup_background_opacity:.7;this.has_popup=a.has_popup!=null?a.has_popup:true;this.has_animation=a.has_animation!=null?a.has_animation:true;switch(this.type){case"counter":this.char_size=a.char_size!=null?a.char_size:null;break;case"gauge":this.has_caption=a.has_caption!=null?a.has_caption:true;this.label=a.label!=null?a.label:"";break;case"thermometer":this.levels=a.levels!=null?a.levels:32;break;case"barChart":this.type="bar_chart";case"bar_chart":this.financial_mode=a.financial_mode!=null?a.financial_mode:false;this.financial_max=a.financial_max!=null?a.financial_max:-1;this.value_text=a.value_text!=null?" "+a.value_text:"";this.no_fill=a.no_fill!=null?a.no_fill:false;this.bar_colors=a.line_colors!=null?a.line_colors:null;this.bar_opacity=a.bar_opacity!=null?a.bar_opacity:1;this.bar_rounded_radius=a.bar_rounded_radius!=null?a.bar_rounded_radius:0;this.bar_top_cap=a.bar_top_cap!=null?a.bar_top_cap:false;break;case"lineChart":this.type="line_chart";case"line_chart":this.financial_mode=a.financial_mode!=null?a.financial_mode:false;this.financial_max=a.financial_max!=null?a.financial_max:-1;this.value_text=a.value_text!=null?" "+a.value_text:"";this.no_fill=a.no_fill!=null?a.no_fill:false;this.line_colors=a.line_colors!=null?a.line_colors:null;this.line_width=a.line_width!=null?a.line_width:4;this.dot_width=a.dot_width!=null?a.dot_width:4;break;case"spider":if(a.labels!=null&&a.value!=null&&a.max_value!=null){this.labels=a.labels;this.max_value=a.max_value}else throw"RaphaelAquarious[spider]: missing options";this.value_text=a.value_text!=null?" "+a.value_text:"";this.no_fill=a.no_fill!=null?a.no_fill:false;this.line_colors=a.line_colors!=null?a.line_colors:null;this.line_width=a.line_width!=null?a.line_width:6;this.dot_width=a.dot_width!=null?a.dot_width:8;break;case"___template":this._______=a._______!=null?a._______:null;break;default:throw"RaphaelAquarious: unknown widget type"}};this.constructor();return this}function Widget(a){this.options;this.paper;this.popup;this.svg;this.factory=function(){var a;switch(this.options.type){case"counter":a=drawCounter(this);break;case"gauge":a=drawGauge(this);break;case"thermometer":a=drawThermometer(this);break;case"bar_chart":a=drawBarChart(this);break;case"line_chart":a=drawLineChart(this);break;case"spider":a=drawSpider(this);break}a.paper.renderfix();a.paper.safari();return a};this.updateValue=function(a){this.options.value=a;this.factory();return this};this.update=function(a){if(a!=null)this.options=new Options(a);this.factory(this.options);return this};this.toString=function(){return"Raphael Aquarious Widget\n\n"+this.options.toString()};this.pause=function(){this.paper.forEach(function(a){a.pause()});return this};this.resume=function(){this.paper.forEach(function(a){a.resume()});return this};this.constructor=function(){this.options=new Options(a);this.paper=Raphael(this.options.id_holder,this.options.width,this.options.height);this.factory(a)};this.constructor();return this}function drawCounter(a){var b=a.svg,c=a.paper,d=a.options,e=d.width,f=d.height,g=d.value,h=d.color!=null?d.color:Aquarious.color,i=String(g).length,j=d.char_size!=null,k=j?d.char_size:Math.round(e*2/i),l=k+"px "+Aquarious.font_family,m=g,n,o=function(){if(!j){b.transform("");n=b.getBBox();while(n.width>e||n.height>f){b.transform("s0.9...");n=b.getBBox()}}};if(b==null){b=c.text(e/2,f/2,m).attr({fill:h,font:l,"font-weight":"bold","text-anchor":"middle"})}if(d.has_animation){var p=d.event_duration>0?d.event_duration:300;b.animate(Raphael.animation({opacity:0},p,d.easing,function(){b.attr({text:m}).animate(Raphael.animation({opacity:1},p,d.easing));o()}).delay(d.delay))}else{b.attr({text:m});o()}a.svg=b;return a}function drawGauge(a){var b=a.svg,c=a.paper,d=a.options,e=d.width,f=d.height,g=d.value;if(d.event_duration==0)d.event_duration=3e3;var h=new AnimationAbstraction(d),i,j,k,l,m,n=d.has_caption,o=Math.round(g*100),p=n?f*.85:f,q=20,r=Math.min(e/2,p)-q*2,s=e/2,t=r+q,u=d.label;g=g>=0&&g<=1?g*180:180;c.customAttributes.segment=function(a,b,c,e,f){var g=Math.PI/180,h=d.color!=null?d.color:"hsb("+(f-e)/720+", 1, 1)",i=a-c*Math.cos(-e*g),j=a-c*Math.cos(-f*g),k=b+c*Math.sin(-e*g),l=b+c*Math.sin(-f*g);return{path:["M",a,b,"L",i,k,"A",c,c,0,+(f-e>180),1,j,l,"z"],fill:h}};c.customAttributes.value=function(a){return{text:Math.round(a)+"% "+u}};l=d.has_animation?0:g;m=Math.round(l*100);if(b==null){i=c.path().attr({segment:[s,t,r,0,180]}).attr({"stroke-opacity":0,fill:"#EEE"});j=c.path().attr({"stroke-opacity":0,"stroke-linejoin":"round",segment:[s,t,r,0,l]});if(n){var v=r*.25;if(v<20)v=20;var w=v+"px "+Aquarious.font_family,x="#CCC";k=c.text(s,t+v/1.5,m+"% "+u).attr({fill:x,font:w,"text-anchor":"middle",value:l})}}else{if(n)k=b.pop();j=b.pop();i=b.pop()}h.handle(j,{segment:[s,t,r,0,g]});if(n){h.handle(k,{value:o})}b=c.set().push(i,j);if(n)b.push(k);a.svg=b;return a}function drawThermometer(a){var b=a.svg,c=a.paper,d=a.options,e=d.width,f=d.height,g=d.value;if(d.event_duration==0)d.event_duration=2500;var h=b==null?new AnimationAbstraction(d):a.animator,i=d.levels,j,k=5,l=35,m,n,o=(e-5)/i-4,p=f-40,q=5,r=4+o,s=2,t=0,u=100,v=50,w=120/i,x="#333",y,z,A;if(b==null){n=0;y=[];for(j=0;j<i;j++){y[j]=c.rect(k,l,o,p,q).attr({"stroke-width":s,fill:Raphael.hsl(t,u,v)});k+=r;t+=w}z="M16,3.5c-4.142,0-7.5,3.358-7.5,7.5c0,4.143,7.5,18.121,7.5,18.121S23.5,15.143,23.5,11C23.5,6.858,20.143,3.5,16,3.5z M16,14.584c-1.979,0-3.584-1.604-3.584-3.584S14.021,7.416,16,7.416S19.584,9.021,19.584,11S17.979,14.584,16,14.584z";A=c.path(z).attr({fill:x,stroke:"none",transform:"T"+(-11+o/2)+"0,10S1.8"})}else{A=b.pop();n=a.last_value}m=(g-n)*r;h.handle(A,{transform:["...T",m,0]});c.renderfix();b=c.set().push(A);a.svg=b;a.last_value=g;a.animator=h;return a}function drawBarChart(a){var b=a.svg,c=a.paper,d=a.options,e=d.width,f=d.height,g=new Array(d.value);if(d.event_duration==0)d.event_duration=600;if(d.delay==0)d.delay=100;var h=new AnimationAbstraction(d);var i=d.delay,j=b==null?d.event_duration:0;var k,l,m,n,o,p,q=20,r=10,s=25,t,u,v=[],w,x,y=d.financial_mode,z=500,A=d.financial_max,B=0,C=0,D=0,E=1,F,G,H,I,J=[],K=[],L=[],M=[],N,O=.2,P=d.bar_width,Q=d.bar_opacity,R=d.bar_rounded_radius,S=d.bar_top_cap,T=[],U=d.bar_colors?d.bar_colors:new Array(Aquarious.color),V=[],W,X=c.set();var Y,Z=d.value_text,$=d.popup_background_color,_=d.popup_background_opacity,ab,bb=false,cb,db;if(b==null){cb=c.set();cb.push(c.text(60,12,"x_value").attr(Aquarious.txt));m=30;for(k=0;k<g.length;k++){cb.push(c.text(60,m,"y_value#i").attr(Aquarious.txt1).attr({fill:U[0],"font-weight":"bold"}));m+=15}cb.hide();db=c.popup(100,100,cb,"right").attr({fill:$,stroke:"#666","stroke-width":2,"fill-opacity":_}).hide()}else{cb=b.popup_label;db=b.popup_frame}switch(Aquarious.lang_ui){case"ES":Y=" en";break;default:Y=" in"}for(w=0;w<g.length;w++){for(k=0;k<g[w].length;k++){if(B<g[w][k].x)B=g[w][k].x;if(C<g[w][k].y)C=g[w][k].y;if(D>g[w][k].y)D=g[w][k].y;if(!inArray(v,g[w][k].x))v.push(g[w][k].x)}}v.sort();if(y){G=5;if(C>0)E=Math.floor(Math.log(C)/Math.log(10));F=C<z?z:Math.pow(10,E)*5;if(A>-1&&F>=A){F=Math.pow(10,E);while(C>=F)F+=Math.pow(10,E)}else{if(C>=F)F*=2}}else{G=6;F=C==0?6:Math.ceil(C*1.2);while(typeof (F/G)=="number"&&(F/G).toString().indexOf(".")!=-1)F++}if(b!=null){if(F>b.ceiling){a.svg=null;c.clear();return drawBarChart(a)}else if(F<b.ceiling){F=b.ceiling}}r=r*String(F).length;p=r+12;t=e-p;u=f-60;o=G;W=e/v.length;for(k=0;k<=G;k++){m=q+u/G*k;if(b==null){c.text(r,m,formatCurrency(F/G*o--,"",Aquarious.thousands,Aquarious.decimal,false)).attr(Aquarious.txt2).attr({"text-anchor":"end"});c.path("M"+p+" "+m+"H"+e).attr({"stroke-width":O})}}t-=t*.1;H=Math.floor(t/(v[v.length-1].toString().length*10));if(H>v.length)H=v.length;I=Math.ceil(v.length/H);if(b!=null){V=b.over_areas;J=b.bars;T=b.bars_top_caps}for(w=0;w<g.length;w++){if(b==null){J[w]=[];T[w]=[];V[w]=[]}l=p+t*.05-t/(g[w].length-1);for(k=0;k<g[w].length;k++){l+=t/(g[w].length-1);P=t/2/(g[w].length-1);if(w==0&&b==null){if(k%I==0){c.text(l,m+s,g[w][k].x).attr(Aquarious.txt2);c.path(Raphael.format("M{0} {1}V{2}",l,m+8,u+20)).attr({"stroke-width":O})}}n=q+Math.abs(u-u/F*g[w][k].y);M[k]="M"+l+" "+n+" L";if(b==null){J[w][k]=c.rect(l-P/2,m,P,0,R).attr({"stroke-width":0,fill:U[w],"fill-opacity":Q,transform:"r180"});if(S){T[w][k]=c.rect(l-P/2,m,P,4).attr({"stroke-width":0,fill:U[w]})}}h.handleCustom(J[w][k],{event_duration:d.event_duration-300,delay:i-200},{height:m-n});if(S){h.handleCustom(T[w][k],{event_duration:d.event_duration-300,delay:i-200},{y:n})}K[k]=l;L[k]=n;if(k==0)N="M"+l+" "+m+" L"+l+" "+n;else N+=" "+l+" "+n;if(b==null){V[w][k]=c.rect(l-W/2,s,W,u).attr({stroke:"none",fill:U[w],"fill-opacity":0})}i+=j;if(b==null){if(w==0&&k==0){function eb(a,b,d,e){V[e][k].mouseover(function(){var f,h,i,j,k,l;clearTimeout(ab);if(y)cb[0].attr({text:formatCurrency(g[e][d].y,Aquarious.currency,Aquarious.thousands,Aquarious.decimal,false)});else cb[0].attr({text:g[e][d].y+Z+(Z!=""&&g[e][d].y!=1?"s":"")+Y});cb[1].attr({text:g[e][d].x,fill:U[e]});j=45;var m="top";if(Math.abs(b-u)+db.getBBox().height>u){m="bottom"}k=c.popup(a,b,cb,m,1);l=Raphael.animation({path:k.path,transform:["t",k.dx,k.dy]},250*bb);i=cb[0].transform()[0][1]+k.dx;j=cb[0].transform()[0][2]+k.dy;db.show().stop().animate(l);for(f=0;f<cb.length;f++){cb[f].show().stop().animateWith(db,l,{transform:["t",i,j]},250*bb)}bb=true});V[e][k].mouseout(function(){for(var a=1;a<g.length;a++){cb[a+1].attr({opacity:0})}ab=setTimeout(function(){db.hide();cb.hide();bb=false},1)})}}}else{V[w][k].unbindAll()}eb(l,n,k,w)}}db.toFront();cb.toFront();for(w=0;w<V.length;w++){for(k=0;k<V[w].length;k++){V[w][k].toFront()}}b=new Object;b.popup_label=cb;b.popup_frame=db;b.bars=J;b.bars_top_caps=T;b.over_areas=V;b.ceiling=F;a.svg=b;return a}function drawLineChart(a){var b=a.svg,c=a.paper,d=a.options,e=d.width,f=d.height,g=d.value;if(d.event_duration==0)d.event_duration=600;if(d.delay==0)d.delay=100;var h=new AnimationAbstraction(d);var i=d.delay,j=b==null?d.event_duration:0;var k,l,m,n,o,p,q=20,r=10,s=25,t,u,v=[],w=g[0]instanceof Array,x,y,z=d.financial_mode,A=500,B=d.financial_max,C=0,D=0,E=0,F=1,G,H,I,J,K=[],L=[],M=[],N=[],O,P=.2,Q=d.line_width,R=d.dot_width,S=d.line_colors?d.line_colors:new Array(Aquarious.color),T=[],U=[],V=[],W,X=c.set(),Y=[],Z=[];if(!w)g=new Array(g);var $,_=d.value_text,ab=d.popup_background_color,bb=d.popup_background_opacity,cb,db=false,eb,fb;if(b==null){eb=c.set();eb.push(c.text(60,12,"x_value").attr(Aquarious.txt));m=30;for(k=0;k<g.length;k++){eb.push(c.text(60,m,"y_value#i").attr(Aquarious.txt1).attr({fill:S[0],"font-weight":"bold"}));m+=15}eb.hide();fb=c.popup(100,100,eb,"right").attr({fill:ab,stroke:"#666","stroke-width":2,"fill-opacity":bb}).hide()}else{eb=b.popup_label;fb=b.popup_frame}switch(Aquarious.lang_ui){case"ES":$=" en";break;default:$=" in"}for(x=0;x<g.length;x++){for(k=0;k<g[x].length;k++){if(C<g[x][k].x)C=g[x][k].x;if(D<g[x][k].y)D=g[x][k].y;if(E>g[x][k].y)E=g[x][k].y;if(!inArray(v,g[x][k].x))v.push(g[x][k].x)}}v.sort();if(z){H=5;if(D>0)F=Math.floor(Math.log(D)/Math.log(10));G=D<A?A:Math.pow(10,F)*5;if(B>-1&&G>=B){G=Math.pow(10,F);while(D>=G)G+=Math.pow(10,F)}else{if(D>=G)G*=2}}else{H=6;G=D==0?6:Math.ceil(D*1.2);while(typeof (G/H)=="number"&&(G/H).toString().indexOf(".")!=-1)G++}if(b!=null){if(G>b.ceiling){a.svg=null;c.clear();return drawLineChart(a)}else if(G<b.ceiling){G=b.ceiling}}r=r*String(G).length;p=r+12;t=e-p;u=f-60;o=H;W=e/v.length;for(k=0;k<=H;k++){m=q+u/H*k;if(b==null){c.text(r,m,formatCurrency(G/H*o--,"",Aquarious.thousands,Aquarious.decimal,false)).attr(Aquarious.txt2).attr({"text-anchor":"end"});c.path("M"+p+" "+m+"H"+e).attr({"stroke-width":P})}}t-=t*.1;I=Math.floor(t/(v[v.length-1].toString().length*10));if(I>v.length)I=v.length;J=Math.ceil(v.length/I);if(b!=null){T=b.dots;V=b.over_areas;K=b.lines;X=b.parallel_set;X.forEach(function(a){a.remove()})}for(x=0;x<g.length;x++){if(b==null){T[x]=[];K[x]=[];V[x]=[];Y[x]=c.set();Z[x]=c.set()}l=p+t*.05-t/(g[x].length-1);for(k=0;k<g[x].length;k++){l+=t/(g[x].length-1);if(x==0&&b==null){if(k%J==0){c.text(l,m+s,g[x][k].x).attr(Aquarious.txt2);c.path(Raphael.format("M{0} {1}V{2}",l,m+8,u+20)).attr({"stroke-width":P})}}n=q+Math.abs(u-u/G*g[x][k].y);if(k<g[x].length-1){N[k]="M"+l+" "+n+" L";if(b==null){K[x][k]=c.path(N[k]).attr({stroke:S[x],"stroke-width":Q,"stroke-linejoin":"round"});Z[x].push(K[x][k])}}if(k>0){N[k-1]+=l+" "+n+"z";h.handleCustom(K[x][k-1],{event_duration:d.event_duration-300,delay:i-200},{path:N[k-1]})}L[k]=l;M[k]=n;if(w&&k>0){var gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb=1,ub=[],vb=0;for(y=x-1;y>=0;y--){if(g[y][k-1].x==g[x][k-1].x&&g[y][k-1].y==g[x][k-1].y&&g[y][k].x==g[x][k].x&&g[y][k].y==g[x][k].y){tb++;ub.push(y);vb=y}}if(tb>1&&tb%2==1){K[x][k-1].attr({"stroke-width":Q/tb})}if(tb>1&&tb%2==0){ub.push(x);gb=Raphael.angle(L[k-1],M[k-1],L[k],M[k]);hb=Q/2;pb=c.simpleLine(L[k-1],M[k-1],hb,gb+90);rb=c.simpleLine(L[k],M[k],hb,gb+90);qb=c.simpleLine(L[k-1],M[k-1],hb,gb+270);sb=c.simpleLine(L[k],M[k],hb,gb+270);ib=hb/tb;jb=ib;for(var wb=0;wb<Math.floor(tb/2);wb++){lb=pb.getPointAtLength(ib);mb=rb.getPointAtLength(ib);kb=Raphael.format("M{0},{1} L",lb.x,lb.y);nb=c.path(kb).attr({stroke:S[ub[wb]],"stroke-width":Q/tb+.5});kb+=Raphael.format("{0} {1}z",mb.x,mb.y);if(b==null){h.handleCustom(nb,{event_duration:d.event_duration-300,delay:i-200},{path:kb})}else{nb.attr({path:kb,opacity:0});h.handleCustom(nb,{event_duration:d.event_duration-300,delay:i+d.event_duration-500},{opacity:1})}lb=qb.getPointAtLength(ib);mb=sb.getPointAtLength(ib);kb=Raphael.format("M{0},{1} L",lb.x,lb.y);ob=c.path(kb).attr({stroke:S[ub[wb+Math.floor(tb/2)]],"stroke-width":Q/tb+.5});kb+=Raphael.format("{0} {1}z",mb.x,mb.y);if(b==null){h.handleCustom(ob,{event_duration:d.event_duration-300,delay:i-200},{path:kb})}else{ob.attr({path:kb,opacity:0});h.handleCustom(ob,{event_duration:d.event_duration-300,delay:i+d.event_duration-500},{opacity:1})}ib+=jb;X.push(nb);X.push(ob)}h.handleCustom(T[ub[vb]][k-1],{event_duration:d.event_duration-300,delay:i-200,easing:">"},{"stroke-width":0});h.handleCustom(T[ub[vb]][k],{event_duration:d.event_duration-300,delay:i-200,easing:">"},{"stroke-width":0});pb.remove();rb.remove();qb.remove();sb.remove()}}if(k==0)O="M"+l+" "+m+" L"+l+" "+n;else O+=" "+l+" "+n;if(b==null){T[x][k]=c.circle(l,n,0).attr({stroke:S[x],"stroke-width":R,fill:S[x]});Y[x].push(T[x][k]);h.handleCustom(T[x][k],{event_duration:1e3,delay:i,easing:"elastic"},{r:R})}else{h.handleCustom(T[x][k],{event_duration:d.event_duration-300,delay:i-200},{cx:l,cy:n,"stroke-width":R})}if(b==null){if(w){V[x][k]=c.rect(l-W/2,n-8,W,16).attr({stroke:"none",fill:S[x],"fill-opacity":0})}else{V[x][k]=c.rect(l-W/2,s,W,u).attr({stroke:"none",fill:S[x],"fill-opacity":0})}}else{if(w){h.handleCustom(V[x][k],{event_duration:d.duration-300,delay:i-200},{y:n-8})}}i+=j;if(b==null){if(x==0&&k==0){function xb(a,b,d,e){V[e][k].mouseover(function(){var f,h,i,j,k,l,m;T[e][d].animate({transform:"s1.5",fill:"#fff"},200,">");clearTimeout(cb);if(z)eb[0].attr({text:formatCurrency(g[e][d].y,Aquarious.currency,Aquarious.thousands,Aquarious.decimal,false)});else eb[0].attr({text:g[e][d].y+_+(_!=""&&g[e][d].y!=1?"s":"")+$});eb[1].attr({text:g[e][d].x,fill:S[e]});j=45;for(h=0;h<g.length-1;h++){eb[h+2].attr({opacity:0,y:30});if(h!=e){k=g[h][d].x==g[e][d].x&&g[h][d].y==g[e][d].y;if(k){T[e][d].animate({transform:"s1.8",fill:S[h]},200,">");eb[h+2].attr({text:g[h][d].x,fill:S[h],opacity:1,y:j});j+=15}else{}}}var n="bottom";if(b+fb.getBBox().height>u){n="top"}l=c.popup(a,b,eb,n,1);m=Raphael.animation({path:l.path,transform:["t",l.dx,l.dy]},250*db);i=eb[0].transform()[0][1]+l.dx;j=eb[0].transform()[0][2]+l.dy;fb.show().stop().animate(m);for(f=0;f<eb.length;f++){eb[f].show().stop().animateWith(fb,m,{transform:["t",i,j]},250*db)}db=true});V[e][k].mouseout(function(){for(var a=1;a<g.length;a++){eb[a+1].attr({opacity:0})}T[e][d].animate({transform:"s1",fill:S[e]},400,"<");cb=setTimeout(function(){fb.hide();eb.hide();db=false},1)})}}}else{V[x][k].unbindAll()}xb(l,n,k,x)}if(!d.no_fill){if(b==null){U[x]=c.path(O+" "+l+" "+m+"z").attr({stroke:"none",fill:S[x],"fill-opacity":.2,opacity:0});h.handleCustom(U[x],{event_duration:1e3,delay:i},{opacity:1})}else{U[x]=b.fill[x];h.handleCustom(U[x],{event_duration:d.duration-300,delay:i-200},{path:O+" "+l+" "+m+"z"})}}for(k=0;k<T[x].length;k++){T[x][k].toFront()}}fb.toFront();eb.toFront();for(x=0;x<V.length;x++){for(k=0;k<V[x].length;k++){V[x][k].toFront()}}b=new Object;b.popup_label=eb;b.popup_frame=fb;b.lines=K;b.dots=T;b.fill=U;b.over_areas=V;b.ceiling=G;b.lines_set=Z;b.dots_set=Y;b.parallel_set=X;a.svg=b;return a}function drawSpider(a){var b=a.svg,c=a.paper,d=a.options,e=d.width,f=d.height,g=d.labels,h=d.value,i=d.max_value;if(d.event_duration==0)d.event_duration=1200;if(d.delay==0)d.delay=200;var j=new AnimationAbstraction(d);var k,l=h[0]instanceof Array,m=0,n,o=d.line_width,p=d.dot_width,q=.8,r="#BBB",s=g.length<3?3:g.length,t,u=0,v=e/2,w=f/2,x,z=[],A={font:"15px Helvetica, Arial",fill:r,"text-anchor":"start"},B="middle";if(f>e)f=e;t=f/2/(i+2);if(b==null){x=c.set();for(k=0;k<i;k++){u+=t;x.push(c.polygon(v,w,u,s).attr({stroke:r,"stroke-width":q}));c.text(v+3,w-u+t/2+5,k).attr(A)}c.text(v+3,w-(u+=t)+t/2+5,i+"+").attr(A);var C=c.polygon(v,w,u,s).hide().getCornersArray();for(k=0;k<s;k++){c.path(Raphael.format("M{0} {1}L{2} {3}",v,w,C[k].x,C[k].y)).attr({stroke:r,"stroke-width":q});if(k==0||k==s/2)B="middle";else if(k>s/2)B="end";else B="start";z[k]=c.text(C[k].x,C[k].y,g[k]).attr(Aquarious.txt2).attr({"text-anchor":B})}}else{x=b.polygons}var D,E,F,G,H=[],I=[],J,K=[],L=[],M=[],N=[],O=t*.6,P=c.set(),Q=d.no_fill?0:.2,R=d.line_colors?d.line_colors:new Array(Aquarious.color);if(!l)h=new Array(h);var S,T,U=d.value_text,V=d.popup_background_color,W=d.popup_background_opacity,X,Y=false,Z,$,_=[];for(k=0;k<g.length;k++){T=c.text(0,0,g[k]).attr(Aquarious.txt).attr({"font-weight":"bold"});_[k]=T.getBBox().height;T.remove()}if(b==null){Z=c.set();Z.push(c.text(60,12,"x_value").attr(Aquarious.txt));y=30;for(k=0;k<h.length;k++){Z.push(c.text(60,y,"y_value#i").attr(Aquarious.txt1).attr({fill:R[0],"font-weight":"bold"}));y+=_[k]}Z.hide();$=c.popup(100,100,Z,"right").attr({fill:V,stroke:"#666","stroke-width":2,"fill-opacity":W}).hide()}else{Z=b.popup_label;$=b.popup_frame}switch(Aquarious.lang_ui){case"ES":S=" en";break;default:S=" in"}if(b!=null){M=b.dots;N=b.over_areas;H=b.shape;P=b.parallel_set;P.forEach(function(a){a.remove()})}for(m=0;m<h.length;m++){I[m]=[];for(k=0;k<h[m].length;k++){G=h[m][k]-1;if(G>=0){if(G>=i)I[m].push(x[i-1].getCornersArray()[k]);else I[m].push(x[G].getCornersArray()[k])}else I[m].push({x:v,y:w})}}for(m=0;m<I.length;m++){J="M";if(b==null){M[m]=[];N[m]=[]}for(k=0;k<I[m].length;k++){E=I[m][k].x;F=I[m][k].y;J+=E+","+F+" L";K[k]=E;L[k]=F;if(b==null){M[m][k]=c.circle(v,w,0).attr({stroke:R[m],"stroke-width":0,fill:R[m]});j.pushToTimelineDelayed(M[m][k],{cx:E,cy:F,r:p/2,"stroke-width":p/2})}else{j.pushToTimelineUndelayed(M[m][k],{cx:E,cy:F,r:p/2,"stroke-width":p/2})}if(b==null){N[m][k]=c.circle(E,F,O).attr({stroke:"none",fill:R[m],"fill-opacity":0})}else{j.pushToTimelineUndelayed(N[m][k],{cx:E,cy:F})}if(b==null){if(m==0&&k==0){function ab(a,b,d,e){N[e][k].mouseover(function(){var f,i,l;j.handleCustom(M[e][d],{event_duration:200,delay:0,easing:">"},{transform:"s1.5",fill:"#fff"});clearTimeout(X);Z[0].attr({text:h[e][d]+U+(U!=""&&h[e][d]!=1?"s":"")+S});i=22+_[d]/2;Z[1].attr({text:g[d],fill:R[e],y:i});for(m=0;m<h.length;m++){if(m<h.length-1){Z[m+2].attr({opacity:0,y:30})}if(m!=e){l=I[m][d].x==I[e][d].x&&I[m][d].y==I[e][d].y;if(l){i+=_[d];j.handleCustom(M[e][d],{event_duration:200,delay:0,easing:">"},{transform:"s1.8",fill:R[m]});if(Z[m+2]!=null){Z[m+2].attr({text:g[d],fill:R[m],opacity:1,y:i})}}else{j.handleCustom(H[m],{event_duration:200,delay:0,easing:">"},{opacity:.2})}}}var n="right";if(a+$.getBBox().width>333){n="left"}var o=c.popup(a,b,Z,n,1),p=Raphael.animation({path:o.path,transform:["t",o.dx,o.dy]},250*Y);f=Z[0].transform()[0][1]+o.dx;i=Z[0].transform()[0][2]+o.dy;$.show().stop().animate(p);for(k=0;k<Z.length;k++){Z[k].show().stop().animateWith($,p,{transform:["t",f,i]},250*Y)}Y=true});N[e][k].mouseout(function(){for(var a=0;a<h.length;a++){j.handleCustom(H[a],{event_duration:200,delay:0,easing:">"},{opacity:1});if(a>0){Z[a+1].attr({opacity:0})}}j.handleCustom(M[e][d],{event_duration:400,delay:0,easing:"<"},{transform:"s1",fill:R[e]});X=setTimeout(function(){$.hide();Z.hide();Y=false},1)})}}}else{N[m][k].unbindAll()}ab(E,F,k,m)}J+="z";if(b==null){H[m]=c.path(J).attr({stroke:R[m],fill:R[m],"fill-opacity":Q,opacity:0,"stroke-width":o,"stroke-linejoin":"round"});j.pushToTimelineCustom(H[m],{delay:d.event_duration},{opacity:1})}else{j.pushToTimelineCustom(H[m],{delay:0},{path:J})}if(l){for(k=1;k<=I[m].length;k++){var bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob=1,pb=[],qb=0;D=k%I[m].length;for(n=m-1;n>=0;n--){if(I[n][k-1].x==I[m][k-1].x&&I[n][k-1].y==I[m][k-1].y&&I[n][D].x==I[m][D].x&&I[n][D].y==I[m][D].y){ob++;pb.push(n);qb=n}}if(ob>1){pb.push(m);bb=Raphael.angle(K[k-1],L[k-1],K[D],L[D]);cb=o/2;kb=c.simpleLine(K[k-1],L[k-1],cb,bb+90);mb=c.simpleLine(K[D],L[D],cb,bb+90);lb=c.simpleLine(K[k-1],L[k-1],cb,bb+270);nb=c.simpleLine(K[D],L[D],cb,bb+270);db=cb/ob;eb=db;for(var rb=0;rb<Math.floor(ob/2);rb++){gb=kb.getPointAtLength(db);hb=mb.getPointAtLength(db);fb=Raphael.format("M{0},{1} L{2} {3}z",gb.x,gb.y,hb.x,hb.y);ib=c.path(fb).attr({stroke:R[pb[rb]],"stroke-width":o/ob+.5,"stroke-opacity":0});gb=lb.getPointAtLength(db);hb=nb.getPointAtLength(db);fb=Raphael.format("M{0},{1} L{2} {3}z",gb.x,gb.y,hb.x,hb.y);jb=c.path(fb).attr({stroke:R[pb[rb+Math.floor(ob/2)]],"stroke-width":o/ob+.5,"stroke-opacity":0});if(b==null){j.nextEventDuration(d.event_duration-300);j.pushToTimelineUndelayed(ib,{"stroke-opacity":1});j.nextEventDuration(d.event_duration-300);j.pushToTimelineUndelayed(jb,{"stroke-opacity":1})}else{j.handleCustom(ib,{delay:d.event_duration},{"stroke-opacity":1});j.handleCustom(jb,{delay:d.event_duration},{"stroke-opacity":1})}db+=eb;P.push(ib);P.push(jb)}kb.remove();mb.remove();lb.remove();nb.remove()}if(ob>1&&ob%2==1){fb=Raphael.format("M{0},{1} L{2} {3}z",I[m][k-1].x,I[m][k-1].y,I[m][D].x,I[m][D].y)}for(n=m-1;n>=0;n--){if(m!=n&&I[m][D].x==I[n][D].x&&I[m][D].y==I[n][D].y){if(b==null){j.pushToTimelineUndelayed(M[n][D],{"stroke-width":p*1.2})}else{j.handle(M[n][D],{"stroke-width":p*1.2})}}}}}for(k=0;k<M[m].length;k++){M[m][k].toFront()}}$.toFront();Z.toFront();for(m=0;m<N.length;m++){for(k=0;k<N[m].length;k++){N[m][k].toFront()}}b=new Object;b.popup_label=Z;b.popup_frame=$;b.polygons=x;b.dots=M;b.over_areas=N;b.shape=H;b.parallel_set=P;a.svg=b;return a}Aquarious={lang_ui:"ES",currency:"â‚¬",thousands:".",decimal:",",color:"#EE6831",font_family:"Helvetica, Arial",txt:{font:"14px Helvetica, Arial",fill:"#fff"},txt1:{font:"14px Helvetica, Arial",fill:"#fff"},txt2:{font:"15px Helvetica, Arial",fill:"#000"}};Raphael.el.getCornersArray=function(){var a,b,c,d;d=this.data("coordinates");if(d==null){alert("entra");try{d=[];for(a=0;a<this.node.pathSegList.numberOfItems;a++){c=this.node.pathSegList.getItem(a);if(c.x){b=new Object;b.x=c.x;b.y=c.y;d.push(b)}}}catch(e){alert("Aquarious: cannot retrieve the coordinates of the given object");return null}}return d};Raphael.el.unbindAll=function(){var a=this.events,b=a.length;while(b--){a[b].unbind()}this.events=[];return this};Raphael.fn.simpleLine=function(a,b,c,d){var e,f;e=this.path(Raphael.format("M{0},{1}h{2}z",a,b,c));if(d!=undefined){e.rotate(d,a,b);f=e.getBBox();e.remove();e=this.path(Raphael.format("M{0},{1}L{2} {3}z",f.x,f.y,f.x+f.width,f.y+f.height))}return e}